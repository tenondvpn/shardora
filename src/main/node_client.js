const Web3 = require('web3')
var net = require('net');
var web3 = new Web3(new Web3.providers.IpcProvider('/Users/myuser/Library/Ethereum/geth.ipc', net));
const { randomBytes } = require('crypto')
const Secp256k1 = require('./secp256k1_1')
const keccak256 = require('keccak256')
var querystring = require('querystring');
var http = require('http');
var fs = require('fs');

function hexToBytes(hex) {
    for (var bytes = [], c = 0; c < hex.length; c += 2)
        bytes.push(parseInt(hex.substr(c, 2), 16));
    return bytes;
}

function PostCode(data) {
    var post_data = querystring.stringify(data);
    var post_options = {
        host: '10.101.20.29',
        port: '8781',
        path: '/transaction',
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'Content-Length': Buffer.byteLength(post_data)
        }
    };

    var post_req = http.request(post_options, function (res) {
        res.setEncoding('utf8');
        res.on('data', function (chunk) {
            if (chunk != "ok") {
                console.log('Response: ' + chunk + ", " + data);
            } else {
                console.log('Response: ' + chunk + ", " + data);
            }
        })
    });

    post_req.write(post_data);
    post_req.end();
}

function GetValidHexString(uint256_bytes) {
    var str_res = uint256_bytes.toString(16)
    while (str_res.length < 64) {
        str_res = "0" + str_res;
    }

    return str_res;
}

function param_contract(tx_type, gid, to, amount, gas_limit, gas_price, contract_bytes, input, prepay, prikey) {
    // 私钥
    const privateKeyBuf = Secp256k1.uint256(prikey, 16)
    var self_private_key = Secp256k1.uint256(privateKeyBuf, 16)
    var self_public_key = Secp256k1.generatePublicKeyFromPrivateKeyData(self_private_key)

    // 将内容编码
    var gid = GetValidHexString(Secp256k1.uint256(randomBytes(32)));
    var frompk = '04' + self_public_key.x.toString(16) + self_public_key.y.toString(16);
    const MAX_UINT32 = 0xFFFFFFFF;
    var amount_buf = new Buffer(8);
    var big = ~~(amount / MAX_UINT32)
    var low = (amount % MAX_UINT32) - big
    amount_buf.writeUInt32LE(big, 4)
    amount_buf.writeUInt32LE(low, 0)

    var gas_limit_buf = new Buffer(8);
    var big = ~~(gas_limit / MAX_UINT32)
    var low = (gas_limit % MAX_UINT32) - big
    gas_limit_buf.writeUInt32LE(big, 4)
    gas_limit_buf.writeUInt32LE(low, 0)

    var gas_price_buf = new Buffer(8);
    var big = ~~(gas_price / MAX_UINT32)
    var low = (gas_price % MAX_UINT32) - big
    gas_price_buf.writeUInt32LE(big, 4)
    gas_price_buf.writeUInt32LE(low, 0)

    var step_buf = new Buffer(8);
    var big = ~~(tx_type / MAX_UINT32)
    var low = (tx_type % MAX_UINT32) - big
    step_buf.writeUInt32LE(big, 0)
    step_buf.writeUInt32LE(low, 0)

    var prepay_buf = new Buffer(8);
    var big = ~~(prepay / MAX_UINT32)
    var low = (prepay % MAX_UINT32) - big
    prepay_buf.writeUInt32LE(big, 4)
    prepay_buf.writeUInt32LE(low, 0)

    var message_buf = Buffer.concat([Buffer.from(gid, 'hex'), Buffer.from(frompk, 'hex'), Buffer.from(to, 'hex'),
        amount_buf, gas_limit_buf, gas_price_buf, step_buf, Buffer.from(contract_bytes, 'hex'), Buffer.from(input, 'hex'), prepay_buf]);

    // 签名
    var kechash = keccak256(message_buf)
    var digest = Secp256k1.uint256(kechash, 16)
    const sig = Secp256k1.ecsign(self_private_key, digest)
    const sigR = Secp256k1.uint256(sig.r, 16)
    const sigS = Secp256k1.uint256(sig.s, 16)

    // 发送给链的交易参数
    return {
        'gid': gid,
        'pubkey': '04' + self_public_key.x.toString(16) + self_public_key.y.toString(16),
        'to': to,
        'amount': amount,
        'gas_limit': gas_limit,
        'gas_price': gas_price,
        'type': tx_type,
        'shard_id': 3,
        'hash': kechash,
        'attrs_size': 4,
        "bytes_code": contract_bytes,
        "input": input,
        "pepay": prepay,
        'sign_r': sigR.toString(16),
        'sign_s': sigS.toString(16),
        'sign_v': sig.v,
    }
}

function create_tx(to, amount, gas_limit, gas_price) {
    // 私钥
    const privateKeyBuf = Secp256k1.uint256("fa04ebee157c6c10bd9d250fc2c938780bf68cbe30e9f0d7c048e4d081907971", 16)
    var self_private_key = Secp256k1.uint256(privateKeyBuf, 16)
    var self_public_key = Secp256k1.generatePublicKeyFromPrivateKeyData(self_private_key)

    // 将内容编码
    var gid = GetValidHexString(Secp256k1.uint256(randomBytes(32)));
    var tx_type = 0;
    var frompk = '04' + self_public_key.x.toString(16) + self_public_key.y.toString(16);
    const MAX_UINT32 = 0xFFFFFFFF;
    var amount_buf = new Buffer(8);
    var big = ~~(amount / MAX_UINT32)
    var low = (amount % MAX_UINT32) - big
    amount_buf.writeUInt32LE(big, 4)
    amount_buf.writeUInt32LE(low, 0)

    var gas_limit_buf = new Buffer(8);
    var big = ~~(gas_limit / MAX_UINT32)
    var low = (gas_limit % MAX_UINT32) - big
    gas_limit_buf.writeUInt32LE(big, 4)
    gas_limit_buf.writeUInt32LE(low, 0)

    var gas_price_buf = new Buffer(8);
    var big = ~~(gas_price / MAX_UINT32)
    var low = (gas_price % MAX_UINT32) - big
    gas_price_buf.writeUInt32LE(big, 4)
    gas_price_buf.writeUInt32LE(low, 0)
    var step_buf = new Buffer(8);
    var big = ~~(tx_type / MAX_UINT32)
    var low = (tx_type % MAX_UINT32) - big
    step_buf.writeUInt32LE(big, 0)
    step_buf.writeUInt32LE(low, 0)

    var message_buf = Buffer.concat([Buffer.from(gid, 'hex'), Buffer.from(frompk, 'hex'), Buffer.from(to, 'hex'),
        amount_buf, gas_limit_buf, gas_price_buf, step_buf]);

    // 签名
    var kechash = keccak256(message_buf)
    var digest = Secp256k1.uint256(kechash, 16)
    const sig = Secp256k1.ecsign(self_private_key, digest)
    const sigR = Secp256k1.uint256(sig.r, 16)
    const sigS = Secp256k1.uint256(sig.s, 16)

    // 发送给链的交易参数
    return {
        'gid': gid,
        'pubkey': '04' + self_public_key.x.toString(16) + self_public_key.y.toString(16),
        'to': to,
        'amount': amount,
        'gas_limit': gas_limit,
        'gas_price': gas_price,
        'type': tx_type,
        'shard_id': 3,
        'sign_r': sigR.toString(16),
        'sign_s': sigS.toString(16),
        'sign_v': sig.v,
    }
}

// 创建合约
function new_contract(contract_bytes, prikey) {
    var gid = GetValidHexString(Secp256k1.uint256(randomBytes(32)));
    const privateKeyBuf = Secp256k1.uint256(prikey, 16)
    var self_private_key = Secp256k1.uint256(privateKeyBuf, 16)
    var self_public_key = Secp256k1.generatePublicKeyFromPrivateKeyData(self_private_key)
    var pk_bytes = hexToBytes(self_public_key.x.toString(16) + self_public_key.y.toString(16))
    var address = keccak256(pk_bytes).toString('hex')
    var self_account_id = address.slice(address.length - 40, address.length)
    var kechash = keccak256(self_account_id + gid + contract_bytes).toString('hex')
    var self_contract_address = kechash.slice(kechash.length - 40, kechash.length)
    var data = param_contract(
        6,
        gid,
        self_contract_address,
        10000000,
        10000000,
        1,
        contract_bytes,
        "",
        999999999,
        prikey);
    PostCode(data);

    const opt = { flag: 'w', }
    fs.writeFile('contract_address', self_contract_address, opt, (err) => {
        if (err) {
            console.error(err)
        }
    })
}

// 调用合约, 收回预付费 input = ""
function call_contract(input, prikey, amount) {
    var contract_address = fs.readFileSync('contract_address', 'utf-8');
    var gid = GetValidHexString(Secp256k1.uint256(randomBytes(32)));
    var data = param_contract(
        8,
        gid,
        contract_address,
        amount,
        10000000,
        1,
        "",
        input,
        0,
        prikey);
    PostCode(data);
}

// 设置预付费 prepayment > 0
function prepay_contract(prikey, prepayment) {
    var contract_address = fs.readFileSync('contract_address', 'utf-8');
    var gid = GetValidHexString(Secp256k1.uint256(randomBytes(32)));
    var data = param_contract(
        7,
        gid,
        contract_address,
        0,
        10000000,
        1,
        "",
        "",
        prepayment,
        prikey);
    PostCode(data);
}

// 普通交易和kv写入
function do_transaction(to_addr, amount, gas_limit, gas_price, key, value) {
    var data = create_tx(to_addr, amount, gas_limit, gas_price);
    PostCode(data);
}

const args = process.argv.slice(2)
var prikey = "fa04ebee157c6c10bd9d250fc2c938780bf68cbe30e9f0d7c048e4d081907971";
if (args.length >= 2) {
    prikey = args[1];
}

// 普通交易，并写入kv数据
if (args[0] == 0) {
    do_transaction(args[1], 100000, 10000, 1, "key", "value");
}

// 创建合约 phr.sol
if (args[0] == 1) {
    new_contract(
        "6080604052604051620024ae380380620024ae833981810160405281019062000029919062000326565b8060009080519060200190620000419291906200008a565b5033600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505062000377565b82805482825590600052602060002090810192821562000106579160200282015b82811115620001055782518260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555091602001919060010190620000ab565b5b50905062000115919062000119565b5090565b5b80821115620001345760008160009055506001016200011a565b5090565b6000604051905090565b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6200019c8262000151565b810181811067ffffffffffffffff82111715620001be57620001bd62000162565b5b80604052505050565b6000620001d362000138565b9050620001e1828262000191565b919050565b600067ffffffffffffffff82111562000204576200020362000162565b5b602082029050602081019050919050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600062000247826200021a565b9050919050565b62000259816200023a565b81146200026557600080fd5b50565b60008151905062000279816200024e565b92915050565b6000620002966200029084620001e6565b620001c7565b90508083825260208201905060208402830185811115620002bc57620002bb62000215565b5b835b81811015620002e95780620002d4888262000268565b845260208401935050602081019050620002be565b5050509392505050565b600082601f8301126200030b576200030a6200014c565b5b81516200031d8482602086016200027f565b91505092915050565b6000602082840312156200033f576200033e62000142565b5b600082015167ffffffffffffffff81111562000360576200035f62000147565b5b6200036e84828501620002f3565b91505092915050565b61212780620003876000396000f3fe6080604052600436106101145760003560e01c80636b83e059116100a0578063b89e70b511610064578063b89e70b5146103e4578063cfefc01014610421578063e645df431461042b578063e9c7feda14610447578063fdba8f111461048457610114565b80636b83e059146102c25780637e280378146102ff5780638da5cb5b1461033e578063a51f8aac14610369578063ae0ad9d9146103a757610114565b8063348a2b91116100e7578063348a2b91146101d85780634819544b146101f45780635f13d6ee146102335780636189d2df14610270578063691b34631461029957610114565b806308ad872a146101195780630ef403f81461014257806329c1cb4b1461017f5780632a1343a7146101bc575b600080fd5b34801561012557600080fd5b50610140600480360381019061013b9190611403565b6104ad565b005b34801561014e57600080fd5b506101696004803603810190610164919061148e565b610615565b60405161017691906114d6565b60405180910390f35b34801561018b57600080fd5b506101a660048036038101906101a191906114f1565b610642565b6040516101b391906114d6565b60405180910390f35b6101d660048036038101906101d191906115e1565b610689565b005b6101f260048036038101906101ed9190611661565b6106dd565b005b34801561020057600080fd5b5061021b6004803603810190610216919061168e565b610731565b60405161022a939291906116ec565b60405180910390f35b34801561023f57600080fd5b5061025a60048036038101906102559190611723565b610785565b604051610267919061175f565b60405180910390f35b34801561027c57600080fd5b5061029760048036038101906102929190611900565b6107c4565b005b3480156102a557600080fd5b506102c060048036038101906102bb919061199f565b6109a2565b005b3480156102ce57600080fd5b506102e960048036038101906102e491906114f1565b610aaf565b6040516102f691906114d6565b60405180910390f35b34801561030b57600080fd5b506103266004803603810190610321919061148e565b610af4565b60405161033593929190611aa9565b60405180910390f35b34801561034a57600080fd5b50610353610c3b565b6040516103609190611b0f565b60405180910390f35b34801561037557600080fd5b50610390600480360381019061038b919061148e565b610c61565b60405161039e929190611b2a565b60405180910390f35b3480156103b357600080fd5b506103ce60048036038101906103c99190611b53565b610c92565b6040516103db91906114d6565b60405180910390f35b3480156103f057600080fd5b5061040b6004803603810190610406919061148e565b610cd7565b60405161041891906114d6565b60405180910390f35b610429610d5e565b005b61044560048036038101906104409190611bdb565b610d99565b005b34801561045357600080fd5b5061046e600480360381019061046991906114f1565b610dee565b60405161047b91906114d6565b60405180910390f35b34801561049057600080fd5b506104ab60048036038101906104a69190611403565b610f07565b005b8051600080549050146104bf57600080fd5b60005b815181101561057f57600081815481106104df576104de611c1b565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1661054c61052c856110bc565b84848151811061053f5761053e611c1b565b5b60200260200101516110ec565b73ffffffffffffffffffffffffffffffffffffffff161461056c57600080fd5b808061057790611c79565b9150506104c2565b5060016003846040516105929190611cfd565b9081526020016040518091039020600084815260200190815260200160002060006101000a81548160ff021916908315150217905550600160046000848152602001908152602001600020846040516105eb9190611cfd565b908152602001604051809103902060006101000a81548160ff021916908315150217905550505050565b60006002600083815260200190815260200160002060020160009054906101000a900460ff169050919050565b60006003836040516106549190611cfd565b9081526020016040518091039020600083815260200190815260200160002060009054906101000a900460ff16905092915050565b808273ffffffffffffffffffffffffffffffffffffffff16427fa6b5ddd331f9dc412a8c258207b1c66f53c1740c72628d9913aafcb6b28d8f73336040516106d1919061175f565b60405180910390a45050565b3373ffffffffffffffffffffffffffffffffffffffff166108fc8267ffffffffffffffff169081150290604051600060405180830381858888f1935050505015801561072d573d6000803e3d6000fd5b5050565b6005602052816000526040600020818154811061074d57600080fd5b9060005260206000209060030201600091509150508060000154908060010154908060020160009054906101000a900460ff16905083565b6000818154811061079557600080fd5b906000526020600020016000915054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b3373ffffffffffffffffffffffffffffffffffffffff16600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161461081e57600080fd5b6006600085815260200190815260200160002060010160009054906101000a900460ff161561084c57600080fd5b805182511461085a57600080fd5b604051806040016040528084815260200160011515815250600660008681526020019081526020016000206000820151816000015560208201518160010160006101000a81548160ff02191690831515021790555090505060008251905060005b8181101561099a576005600086815260200190815260200160002060405180606001604052808684815181106108f4576108f3611c1b565b5b6020026020010151815260200185848151811061091457610913611c1b565b5b60200260200101518152602001600115158152509080600181540180825580915050600190039060005260206000209060030201600090919091909150600082015181600001556020820151816001015560408201518160020160006101000a81548160ff0219169083151502179055505050808061099290611c79565b9150506108bb565b505050505050565b3373ffffffffffffffffffffffffffffffffffffffff16600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16146109fc57600080fd5b6002600084815260200190815260200160002060020160009054906101000a900460ff1615610a2a57600080fd5b604051806060016040528083815260200182815260200160011515815250600260008581526020019081526020016000206000820151816000019081610a709190611f20565b506020820151816001019081610a869190611f20565b5060408201518160020160006101000a81548160ff021916908315150217905550905050505050565b6003828051602081018201805184825260208301602085012081835280955050505050506020528060005260406000206000915091509054906101000a900460ff1681565b6002602052806000526040600020600091509050806000018054610b1790611d43565b80601f0160208091040260200160405190810160405280929190818152602001828054610b4390611d43565b8015610b905780601f10610b6557610100808354040283529160200191610b90565b820191906000526020600020905b815481529060010190602001808311610b7357829003601f168201915b505050505090806001018054610ba590611d43565b80601f0160208091040260200160405190810160405280929190818152602001828054610bd190611d43565b8015610c1e5780601f10610bf357610100808354040283529160200191610c1e565b820191906000526020600020905b815481529060010190602001808311610c0157829003601f168201915b5050505050908060020160009054906101000a900460ff16905083565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60066020528060005260406000206000915090508060000154908060010160009054906101000a900460ff16905082565b6004602052816000526040600020818051602081018201805184825260208301602085012081835280955050505050506000915091509054906101000a900460ff1681565b60003373ffffffffffffffffffffffffffffffffffffffff16600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614610d3357600080fd5b6006600083815260200190815260200160002060010160009054906101000a900460ff169050919050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b8173ffffffffffffffffffffffffffffffffffffffff166108fc8267ffffffffffffffff169081150290604051600060405180830381858888f19350505050158015610de9573d6000803e3d6000fd5b505050565b6000806005600084815260200190815260200160002080549050905060008111610e1757600080fd5b60005b81811015610efa5760046000600560008781526020019081526020016000208381548110610e4b57610e4a611c1b565b5b906000526020600020906003020160000154815260200190815260200160002085604051610e799190611cfd565b908152602001604051809103902060009054906101000a900460ff168015610ed7575042600560008681526020019081526020016000208281548110610ec257610ec1611c1b565b5b90600052602060002090600302016001015410155b15610ee757600192505050610f01565b8080610ef290611c79565b915050610e1a565b5060009150505b92915050565b805160008054905014610f1957600080fd5b60001515600384604051610f2d9190611cfd565b9081526020016040518091039020600084815260200190815260200160002060009054906101000a900460ff16151514610f6657600080fd5b60005b81518110156110265760008181548110610f8657610f85611c1b565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16610ff3610fd3856110bc565b848481518110610fe657610fe5611c1b565b5b60200260200101516110ec565b73ffffffffffffffffffffffffffffffffffffffff161461101357600080fd5b808061101e90611c79565b915050610f69565b5060016003846040516110399190611cfd565b9081526020016040518091039020600084815260200190815260200160002060006101000a81548160ff021916908315150217905550600160046000848152602001908152602001600020846040516110929190611cfd565b908152602001604051809103902060006101000a81548160ff021916908315150217905550505050565b6000816040516020016110cf919061206a565b604051602081830303815290604052805190602001209050919050565b6000806000806110fb8561115b565b9250925092506001868484846040516000815260200160405260405161112494939291906120ac565b6020604051602081039080840390855afa158015611146573d6000803e3d6000fd5b50505060206040510351935050505092915050565b6000806000604184511461116e57600080fd5b6020840151915060408401519050606084015160001a92509193909250565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6111f4826111ab565b810181811067ffffffffffffffff82111715611213576112126111bc565b5b80604052505050565b600061122661118d565b905061123282826111eb565b919050565b600067ffffffffffffffff821115611252576112516111bc565b5b61125b826111ab565b9050602081019050919050565b82818337600083830152505050565b600061128a61128584611237565b61121c565b9050828152602081018484840111156112a6576112a56111a6565b5b6112b1848285611268565b509392505050565b600082601f8301126112ce576112cd6111a1565b5b81356112de848260208601611277565b91505092915050565b6000819050919050565b6112fa816112e7565b811461130557600080fd5b50565b600081359050611317816112f1565b92915050565b600067ffffffffffffffff821115611338576113376111bc565b5b602082029050602081019050919050565b600080fd5b600061136161135c8461131d565b61121c565b9050808382526020820190506020840283018581111561138457611383611349565b5b835b818110156113cb57803567ffffffffffffffff8111156113a9576113a86111a1565b5b8086016113b689826112b9565b85526020850194505050602081019050611386565b5050509392505050565b600082601f8301126113ea576113e96111a1565b5b81356113fa84826020860161134e565b91505092915050565b60008060006060848603121561141c5761141b611197565b5b600084013567ffffffffffffffff81111561143a5761143961119c565b5b611446868287016112b9565b935050602061145786828701611308565b925050604084013567ffffffffffffffff8111156114785761147761119c565b5b611484868287016113d5565b9150509250925092565b6000602082840312156114a4576114a3611197565b5b60006114b284828501611308565b91505092915050565b60008115159050919050565b6114d0816114bb565b82525050565b60006020820190506114eb60008301846114c7565b92915050565b6000806040838503121561150857611507611197565b5b600083013567ffffffffffffffff8111156115265761152561119c565b5b611532858286016112b9565b925050602061154385828601611308565b9150509250929050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006115788261154d565b9050919050565b6115888161156d565b811461159357600080fd5b50565b6000813590506115a58161157f565b92915050565b6000819050919050565b6115be816115ab565b81146115c957600080fd5b50565b6000813590506115db816115b5565b92915050565b600080604083850312156115f8576115f7611197565b5b600061160685828601611596565b9250506020611617858286016115cc565b9150509250929050565b600067ffffffffffffffff82169050919050565b61163e81611621565b811461164957600080fd5b50565b60008135905061165b81611635565b92915050565b60006020828403121561167757611676611197565b5b60006116858482850161164c565b91505092915050565b600080604083850312156116a5576116a4611197565b5b60006116b385828601611308565b92505060206116c4858286016115cc565b9150509250929050565b6116d7816112e7565b82525050565b6116e6816115ab565b82525050565b600060608201905061170160008301866116ce565b61170e60208301856116dd565b61171b60408301846114c7565b949350505050565b60006020828403121561173957611738611197565b5b6000611747848285016115cc565b91505092915050565b6117598161156d565b82525050565b60006020820190506117746000830184611750565b92915050565b600067ffffffffffffffff821115611795576117946111bc565b5b602082029050602081019050919050565b60006117b96117b48461177a565b61121c565b905080838252602082019050602084028301858111156117dc576117db611349565b5b835b8181101561180557806117f18882611308565b8452602084019350506020810190506117de565b5050509392505050565b600082601f830112611824576118236111a1565b5b81356118348482602086016117a6565b91505092915050565b600067ffffffffffffffff821115611858576118576111bc565b5b602082029050602081019050919050565b600061187c6118778461183d565b61121c565b9050808382526020820190506020840283018581111561189f5761189e611349565b5b835b818110156118c857806118b488826115cc565b8452602084019350506020810190506118a1565b5050509392505050565b600082601f8301126118e7576118e66111a1565b5b81356118f7848260208601611869565b91505092915050565b6000806000806080858703121561191a57611919611197565b5b600061192887828801611308565b945050602061193987828801611308565b935050604085013567ffffffffffffffff81111561195a5761195961119c565b5b6119668782880161180f565b925050606085013567ffffffffffffffff8111156119875761198661119c565b5b611993878288016118d2565b91505092959194509250565b6000806000606084860312156119b8576119b7611197565b5b60006119c686828701611308565b935050602084013567ffffffffffffffff8111156119e7576119e661119c565b5b6119f3868287016112b9565b925050604084013567ffffffffffffffff811115611a1457611a1361119c565b5b611a20868287016112b9565b9150509250925092565b600081519050919050565b600082825260208201905092915050565b60005b83811015611a64578082015181840152602081019050611a49565b60008484015250505050565b6000611a7b82611a2a565b611a858185611a35565b9350611a95818560208601611a46565b611a9e816111ab565b840191505092915050565b60006060820190508181036000830152611ac38186611a70565b90508181036020830152611ad78185611a70565b9050611ae660408301846114c7565b949350505050565b6000611af98261154d565b9050919050565b611b0981611aee565b82525050565b6000602082019050611b246000830184611b00565b92915050565b6000604082019050611b3f60008301856116ce565b611b4c60208301846114c7565b9392505050565b60008060408385031215611b6a57611b69611197565b5b6000611b7885828601611308565b925050602083013567ffffffffffffffff811115611b9957611b9861119c565b5b611ba5858286016112b9565b9150509250929050565b611bb881611aee565b8114611bc357600080fd5b50565b600081359050611bd581611baf565b92915050565b60008060408385031215611bf257611bf1611197565b5b6000611c0085828601611bc6565b9250506020611c118582860161164c565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000611c84826115ab565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8203611cb657611cb5611c4a565b5b600182019050919050565b600081905092915050565b6000611cd782611a2a565b611ce18185611cc1565b9350611cf1818560208601611a46565b80840191505092915050565b6000611d098284611ccc565b915081905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680611d5b57607f821691505b602082108103611d6e57611d6d611d14565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b600060088302611dd67fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82611d99565b611de08683611d99565b95508019841693508086168417925050509392505050565b6000819050919050565b6000611e1d611e18611e13846115ab565b611df8565b6115ab565b9050919050565b6000819050919050565b611e3783611e02565b611e4b611e4382611e24565b848454611da6565b825550505050565b600090565b611e60611e53565b611e6b818484611e2e565b505050565b5b81811015611e8f57611e84600082611e58565b600181019050611e71565b5050565b601f821115611ed457611ea581611d74565b611eae84611d89565b81016020851015611ebd578190505b611ed1611ec985611d89565b830182611e70565b50505b505050565b600082821c905092915050565b6000611ef760001984600802611ed9565b1980831691505092915050565b6000611f108383611ee6565b9150826002028217905092915050565b611f2982611a2a565b67ffffffffffffffff811115611f4257611f416111bc565b5b611f4c8254611d43565b611f57828285611e93565b600060209050601f831160018114611f8a5760008415611f78578287015190505b611f828582611f04565b865550611fea565b601f198416611f9886611d74565b60005b82811015611fc057848901518255600182019150602085019450602081019050611f9b565b86831015611fdd5784890151611fd9601f891682611ee6565b8355505b6001600288020188555050505b505050505050565b600081905092915050565b7f19457468657265756d205369676e6564204d6573736167653a0a333200000000600082015250565b6000612033601c83611ff2565b915061203e82611ffd565b601c82019050919050565b6000819050919050565b61206461205f826112e7565b612049565b82525050565b600061207582612026565b91506120818284612053565b60208201915081905092915050565b600060ff82169050919050565b6120a681612090565b82525050565b60006080820190506120c160008301876116ce565b6120ce602083018661209d565b6120db60408301856116ce565b6120e860608301846116ce565b9594505050505056fea2646970667358221220ae777cef41bb9235c253dc5952387022988760ed266c5a453a189eb14a1082d064736f6c6343000811003300000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000003000000000000000000000000e252d01a37b85e2007ed3cc13797aa92496204a40000000000000000000000005f15294a1918633d4dd4ec47098a14d01c58e957000000000000000000000000d45cfd6855c6ec8f635a6f2b46c647e99c59c79d",
        prikey);
}

// 调用合约 phr.sol 的 ResAdd 函数
if (args[0] == 2) {
    call_contract("cfefc010", prikey, 10);
}

if (args[0] == 3) {
    call_contract("348a2b9100000000000000000000000000000000000000000000000000000000000003e8", prikey, 10);
}

if (args[0] == 4) {
    call_contract("e645df43000000000000000000000000e252d01a37b85e2007ed3cc13797aa92496204a400000000000000000000000000000000000000000000000000000000000003e8", prikey, 10);
}

if (args[0] == 5) {
    prepay_contract(prikey, 1000);
}

if (args[0] == 6) {
    call_contract("", prikey, 0);
}

// 测试event
if (args[0] == 7) {
    call_contract("2a1343a70000000000000000000000005f15294a1918633d4dd4ec47098a14d01c58e95700000000000000000000000000000000000000000000000000000000000003e8", prikey, 0);
}
