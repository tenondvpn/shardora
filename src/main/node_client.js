const Web3 = require('web3')
var net = require('net');
var web3 = new Web3(new Web3.providers.IpcProvider('/Users/myuser/Library/Ethereum/geth.ipc', net));
const { randomBytes } = require('crypto')
const Secp256k1 = require('./secp256k1_1')
const keccak256 = require('keccak256')
var querystring = require('querystring');
var http = require('http');
var fs = require('fs');

function hexToBytes(hex) {
    for (var bytes = [], c = 0; c < hex.length; c += 2)
        bytes.push(parseInt(hex.substr(c, 2), 16));
    return bytes;
}

function PostCode(data) {
    var post_data = querystring.stringify(data);
    var post_options = {
        host: '127.0.0.1',
        port: '8781',
        path: '/transaction',
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'Content-Length': Buffer.byteLength(post_data)
        }
    };

    var post_req = http.request(post_options, function (res) {
        res.setEncoding('utf8');
        res.on('data', function (chunk) {
            if (chunk != "ok") {
                console.log('Response: ' + chunk + ", " + data);
            } else {
                console.log('Response: ' + chunk + ", " + data);
            }
        })
    });

    post_req.write(post_data);
    post_req.end();
}

function GetValidHexString(uint256_bytes) {
    var str_res = uint256_bytes.toString(16)
    while (str_res.length < 64) {
        str_res = "0" + str_res;
    }

    return str_res;
}

function param_contract(tx_type, gid, to, amount, gas_limit, gas_price, contract_bytes, input, prepay) {
    // 私钥
    const privateKeyBuf = Secp256k1.uint256("fa04ebee157c6c10bd9d250fc2c938780bf68cbe30e9f0d7c048e4d081907971", 16)
    var self_private_key = Secp256k1.uint256(privateKeyBuf, 16)
    var self_public_key = Secp256k1.generatePublicKeyFromPrivateKeyData(self_private_key)

    // 将内容编码
    var gid = GetValidHexString(Secp256k1.uint256(randomBytes(32)));
    var frompk = '04' + self_public_key.x.toString(16) + self_public_key.y.toString(16);
    const MAX_UINT32 = 0xFFFFFFFF;
    var amount_buf = new Buffer(8);
    var big = ~~(amount / MAX_UINT32)
    var low = (amount % MAX_UINT32) - big
    amount_buf.writeUInt32LE(big, 4)
    amount_buf.writeUInt32LE(low, 0)

    var gas_limit_buf = new Buffer(8);
    var big = ~~(gas_limit / MAX_UINT32)
    var low = (gas_limit % MAX_UINT32) - big
    gas_limit_buf.writeUInt32LE(big, 4)
    gas_limit_buf.writeUInt32LE(low, 0)

    var gas_price_buf = new Buffer(8);
    var big = ~~(gas_price / MAX_UINT32)
    var low = (gas_price % MAX_UINT32) - big
    gas_price_buf.writeUInt32LE(big, 4)
    gas_price_buf.writeUInt32LE(low, 0)

    var step_buf = new Buffer(8);
    var big = ~~(tx_type / MAX_UINT32)
    var low = (tx_type % MAX_UINT32) - big
    step_buf.writeUInt32LE(big, 0)
    step_buf.writeUInt32LE(low, 0)

    var prepay_buf = new Buffer(8);
    var big = ~~(prepay / MAX_UINT32)
    var low = (prepay % MAX_UINT32) - big
    prepay_buf.writeUInt32LE(big, 4)
    prepay_buf.writeUInt32LE(low, 0)

    var message_buf = Buffer.concat([Buffer.from(gid, 'hex'), Buffer.from(frompk, 'hex'), Buffer.from(to, 'hex'),
        amount_buf, gas_limit_buf, gas_price_buf, step_buf, Buffer.from(contract_bytes, 'hex'), Buffer.from(input, 'hex'), prepay_buf]);

    // 签名
    var kechash = keccak256(message_buf)
    var digest = Secp256k1.uint256(kechash, 16)
    const sig = Secp256k1.ecsign(self_private_key, digest)
    const sigR = Secp256k1.uint256(sig.r, 16)
    const sigS = Secp256k1.uint256(sig.s, 16)

    // 发送给链的交易参数
    return {
        'gid': gid,
        'pubkey': '04' + self_public_key.x.toString(16) + self_public_key.y.toString(16),
        'to': to,
        'amount': amount,
        'gas_limit': gas_limit,
        'gas_price': gas_price,
        'type': tx_type,
        'shard_id': 3,
        'hash': kechash,
        'attrs_size': 4,
        "bytes_code": contract_bytes,
        "input": input,
        "pepay": prepay,
        'sign_r': sigR.toString(16),
        'sign_s': sigS.toString(16),
        'sign_v': sig.v,
    }
}

function create_tx(to, amount, gas_limit, gas_price) {
    // 私钥
    const privateKeyBuf = Secp256k1.uint256("fa04ebee157c6c10bd9d250fc2c938780bf68cbe30e9f0d7c048e4d081907971", 16)
    var self_private_key = Secp256k1.uint256(privateKeyBuf, 16)
    var self_public_key = Secp256k1.generatePublicKeyFromPrivateKeyData(self_private_key)

    // 将内容编码
    var gid = GetValidHexString(Secp256k1.uint256(randomBytes(32)));
    var tx_type = 0;
    var frompk = '04' + self_public_key.x.toString(16) + self_public_key.y.toString(16);
    const MAX_UINT32 = 0xFFFFFFFF;
    var amount_buf = new Buffer(8);
    var big = ~~(amount / MAX_UINT32)
    var low = (amount % MAX_UINT32) - big
    amount_buf.writeUInt32LE(big, 4)
    amount_buf.writeUInt32LE(low, 0)

    var gas_limit_buf = new Buffer(8);
    var big = ~~(gas_limit / MAX_UINT32)
    var low = (gas_limit % MAX_UINT32) - big
    gas_limit_buf.writeUInt32LE(big, 4)
    gas_limit_buf.writeUInt32LE(low, 0)

    var gas_price_buf = new Buffer(8);
    var big = ~~(gas_price / MAX_UINT32)
    var low = (gas_price % MAX_UINT32) - big
    gas_price_buf.writeUInt32LE(big, 4)
    gas_price_buf.writeUInt32LE(low, 0)
    var step_buf = new Buffer(8);
    var big = ~~(tx_type / MAX_UINT32)
    var low = (tx_type % MAX_UINT32) - big
    step_buf.writeUInt32LE(big, 0)
    step_buf.writeUInt32LE(low, 0)

    var message_buf = Buffer.concat([Buffer.from(gid, 'hex'), Buffer.from(frompk, 'hex'), Buffer.from(to, 'hex'),
        amount_buf, gas_limit_buf, gas_price_buf, step_buf]);

    // 签名
    var kechash = keccak256(message_buf)
    var digest = Secp256k1.uint256(kechash, 16)
    const sig = Secp256k1.ecsign(self_private_key, digest)
    const sigR = Secp256k1.uint256(sig.r, 16)
    const sigS = Secp256k1.uint256(sig.s, 16)

    // 发送给链的交易参数
    return {
        'gid': gid,
        'pubkey': '04' + self_public_key.x.toString(16) + self_public_key.y.toString(16),
        'to': to,
        'amount': amount,
        'gas_limit': gas_limit,
        'gas_price': gas_price,
        'type': tx_type,
        'shard_id': 3,
        'sign_r': sigR.toString(16),
        'sign_s': sigS.toString(16),
        'sign_v': sig.v,
    }
}

// 创建合约
function new_contract(contract_bytes) {
    var gid = GetValidHexString(Secp256k1.uint256(randomBytes(32)));
    const privateKeyBuf = Secp256k1.uint256("fa04ebee157c6c10bd9d250fc2c938780bf68cbe30e9f0d7c048e4d081907971", 16)
    var self_private_key = Secp256k1.uint256(privateKeyBuf, 16)
    var self_public_key = Secp256k1.generatePublicKeyFromPrivateKeyData(self_private_key)
    var pk_bytes = hexToBytes(self_public_key.x.toString(16) + self_public_key.y.toString(16))
    var address = keccak256(pk_bytes).toString('hex')
    var self_account_id = address.slice(address.length - 40, address.length)
    var kechash = keccak256(self_account_id + gid + contract_bytes).toString('hex')
    var self_contract_address = kechash.slice(kechash.length - 40, kechash.length)
    var data = param_contract(
        6,
        gid,
        self_contract_address,
        10000000,
        10000000,
        1,
        contract_bytes,
        "",
        999999999);
    PostCode(data);

    const opt = { flag: 'w', }
    fs.writeFile('contract_address', self_contract_address, opt, (err) => {
        if (err) {
            console.error(err)
        }
    })
}

// 调用合约
function call_contract(input) {
    var contract_address = fs.readFileSync('contract_address', 'utf-8');
    var gid = GetValidHexString(Secp256k1.uint256(randomBytes(32)));
    var data = param_contract(
        8,
        gid,
        contract_address,
        10000000,
        10000000,
        1,
        "",
        input,
        0);
    PostCode(data);
}

// 普通交易和kv写入
function do_transaction(to_addr, amount, gas_limit, gas_price, key, value) {
    var data = create_tx(to_addr, amount, gas_limit, gas_price);
    PostCode(data);
}

const args = process.argv.slice(2)
// 普通交易，并写入kv数据
if (args[0] == 0) {
    do_transaction(args[1], 100000, 10000, 1, "key", "value");
}

// 创建合约 phr.sol
if (args[0] == 1) {
    new_contract("6080604052604051620023c7380380620023c7833981810160405281019062000029919062000326565b8060009080519060200190620000419291906200008a565b5033600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505062000377565b82805482825590600052602060002090810192821562000106579160200282015b82811115620001055782518260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555091602001919060010190620000ab565b5b50905062000115919062000119565b5090565b5b80821115620001345760008160009055506001016200011a565b5090565b6000604051905090565b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6200019c8262000151565b810181811067ffffffffffffffff82111715620001be57620001bd62000162565b5b80604052505050565b6000620001d362000138565b9050620001e1828262000191565b919050565b600067ffffffffffffffff82111562000204576200020362000162565b5b602082029050602081019050919050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600062000247826200021a565b9050919050565b62000259816200023a565b81146200026557600080fd5b50565b60008151905062000279816200024e565b92915050565b6000620002966200029084620001e6565b620001c7565b90508083825260208201905060208402830185811115620002bc57620002bb62000215565b5b835b81811015620002e95780620002d4888262000268565b845260208401935050602081019050620002be565b5050509392505050565b600082601f8301126200030b576200030a6200014c565b5b81516200031d8482602086016200027f565b91505092915050565b6000602082840312156200033f576200033e62000142565b5b600082015167ffffffffffffffff81111562000360576200035f62000147565b5b6200036e84828501620002f3565b91505092915050565b61204080620003876000396000f3fe6080604052600436106101095760003560e01c80637e28037811610095578063b89e70b511610064578063b89e70b5146103bd578063cfefc010146103fa578063e645df4314610404578063e9c7feda14610420578063fdba8f111461045d57610109565b80637e280378146102d85780638da5cb5b14610317578063a51f8aac14610342578063ae0ad9d91461038057610109565b80634819544b116100dc5780634819544b146101cd5780635f13d6ee1461020c5780636189d2df14610249578063691b3463146102725780636b83e0591461029b57610109565b806308ad872a1461010e5780630ef403f81461013757806329c1cb4b14610174578063348a2b91146101b1575b600080fd5b34801561011a57600080fd5b5061013560048036038101906101309190611388565b610486565b005b34801561014357600080fd5b5061015e60048036038101906101599190611413565b6105ee565b60405161016b919061145b565b60405180910390f35b34801561018057600080fd5b5061019b60048036038101906101969190611476565b61061b565b6040516101a8919061145b565b60405180910390f35b6101cb60048036038101906101c69190611512565b610662565b005b3480156101d957600080fd5b506101f460048036038101906101ef9190611575565b6106b6565b604051610203939291906115d3565b60405180910390f35b34801561021857600080fd5b50610233600480360381019061022e919061160a565b61070a565b6040516102409190611678565b60405180910390f35b34801561025557600080fd5b50610270600480360381019061026b9190611819565b610749565b005b34801561027e57600080fd5b50610299600480360381019061029491906118b8565b610927565b005b3480156102a757600080fd5b506102c260048036038101906102bd9190611476565b610a34565b6040516102cf919061145b565b60405180910390f35b3480156102e457600080fd5b506102ff60048036038101906102fa9190611413565b610a79565b60405161030e939291906119c2565b60405180910390f35b34801561032357600080fd5b5061032c610bc0565b6040516103399190611a28565b60405180910390f35b34801561034e57600080fd5b5061036960048036038101906103649190611413565b610be6565b604051610377929190611a43565b60405180910390f35b34801561038c57600080fd5b506103a760048036038101906103a29190611a6c565b610c17565b6040516103b4919061145b565b60405180910390f35b3480156103c957600080fd5b506103e460048036038101906103df9190611413565b610c5c565b6040516103f1919061145b565b60405180910390f35b610402610ce3565b005b61041e60048036038101906104199190611af4565b610d1e565b005b34801561042c57600080fd5b5061044760048036038101906104429190611476565b610d73565b604051610454919061145b565b60405180910390f35b34801561046957600080fd5b50610484600480360381019061047f9190611388565b610e8c565b005b80516000805490501461049857600080fd5b60005b815181101561055857600081815481106104b8576104b7611b34565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1661052561050585611041565b84848151811061051857610517611b34565b5b6020026020010151611071565b73ffffffffffffffffffffffffffffffffffffffff161461054557600080fd5b808061055090611b92565b91505061049b565b50600160038460405161056b9190611c16565b9081526020016040518091039020600084815260200190815260200160002060006101000a81548160ff021916908315150217905550600160046000848152602001908152602001600020846040516105c49190611c16565b908152602001604051809103902060006101000a81548160ff021916908315150217905550505050565b60006002600083815260200190815260200160002060020160009054906101000a900460ff169050919050565b600060038360405161062d9190611c16565b9081526020016040518091039020600083815260200190815260200160002060009054906101000a900460ff16905092915050565b3373ffffffffffffffffffffffffffffffffffffffff166108fc8267ffffffffffffffff169081150290604051600060405180830381858888f193505050501580156106b2573d6000803e3d6000fd5b5050565b600560205281600052604060002081815481106106d257600080fd5b9060005260206000209060030201600091509150508060000154908060010154908060020160009054906101000a900460ff16905083565b6000818154811061071a57600080fd5b906000526020600020016000915054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b3373ffffffffffffffffffffffffffffffffffffffff16600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16146107a357600080fd5b6006600085815260200190815260200160002060010160009054906101000a900460ff16156107d157600080fd5b80518251146107df57600080fd5b604051806040016040528084815260200160011515815250600660008681526020019081526020016000206000820151816000015560208201518160010160006101000a81548160ff02191690831515021790555090505060008251905060005b8181101561091f5760056000868152602001908152602001600020604051806060016040528086848151811061087957610878611b34565b5b6020026020010151815260200185848151811061089957610898611b34565b5b60200260200101518152602001600115158152509080600181540180825580915050600190039060005260206000209060030201600090919091909150600082015181600001556020820151816001015560408201518160020160006101000a81548160ff0219169083151502179055505050808061091790611b92565b915050610840565b505050505050565b3373ffffffffffffffffffffffffffffffffffffffff16600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161461098157600080fd5b6002600084815260200190815260200160002060020160009054906101000a900460ff16156109af57600080fd5b6040518060600160405280838152602001828152602001600115158152506002600085815260200190815260200160002060008201518160000190816109f59190611e39565b506020820151816001019081610a0b9190611e39565b5060408201518160020160006101000a81548160ff021916908315150217905550905050505050565b6003828051602081018201805184825260208301602085012081835280955050505050506020528060005260406000206000915091509054906101000a900460ff1681565b6002602052806000526040600020600091509050806000018054610a9c90611c5c565b80601f0160208091040260200160405190810160405280929190818152602001828054610ac890611c5c565b8015610b155780601f10610aea57610100808354040283529160200191610b15565b820191906000526020600020905b815481529060010190602001808311610af857829003601f168201915b505050505090806001018054610b2a90611c5c565b80601f0160208091040260200160405190810160405280929190818152602001828054610b5690611c5c565b8015610ba35780601f10610b7857610100808354040283529160200191610ba3565b820191906000526020600020905b815481529060010190602001808311610b8657829003601f168201915b5050505050908060020160009054906101000a900460ff16905083565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60066020528060005260406000206000915090508060000154908060010160009054906101000a900460ff16905082565b6004602052816000526040600020818051602081018201805184825260208301602085012081835280955050505050506000915091509054906101000a900460ff1681565b60003373ffffffffffffffffffffffffffffffffffffffff16600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614610cb857600080fd5b6006600083815260200190815260200160002060010160009054906101000a900460ff169050919050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b8173ffffffffffffffffffffffffffffffffffffffff166108fc8267ffffffffffffffff169081150290604051600060405180830381858888f19350505050158015610d6e573d6000803e3d6000fd5b505050565b6000806005600084815260200190815260200160002080549050905060008111610d9c57600080fd5b60005b81811015610e7f5760046000600560008781526020019081526020016000208381548110610dd057610dcf611b34565b5b906000526020600020906003020160000154815260200190815260200160002085604051610dfe9190611c16565b908152602001604051809103902060009054906101000a900460ff168015610e5c575042600560008681526020019081526020016000208281548110610e4757610e46611b34565b5b90600052602060002090600302016001015410155b15610e6c57600192505050610e86565b8080610e7790611b92565b915050610d9f565b5060009150505b92915050565b805160008054905014610e9e57600080fd5b60001515600384604051610eb29190611c16565b9081526020016040518091039020600084815260200190815260200160002060009054906101000a900460ff16151514610eeb57600080fd5b60005b8151811015610fab5760008181548110610f0b57610f0a611b34565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16610f78610f5885611041565b848481518110610f6b57610f6a611b34565b5b6020026020010151611071565b73ffffffffffffffffffffffffffffffffffffffff1614610f9857600080fd5b8080610fa390611b92565b915050610eee565b506001600384604051610fbe9190611c16565b9081526020016040518091039020600084815260200190815260200160002060006101000a81548160ff021916908315150217905550600160046000848152602001908152602001600020846040516110179190611c16565b908152602001604051809103902060006101000a81548160ff021916908315150217905550505050565b6000816040516020016110549190611f83565b604051602081830303815290604052805190602001209050919050565b600080600080611080856110e0565b925092509250600186848484604051600081526020016040526040516110a99493929190611fc5565b6020604051602081039080840390855afa1580156110cb573d6000803e3d6000fd5b50505060206040510351935050505092915050565b600080600060418451146110f357600080fd5b6020840151915060408401519050606084015160001a92509193909250565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b61117982611130565b810181811067ffffffffffffffff8211171561119857611197611141565b5b80604052505050565b60006111ab611112565b90506111b78282611170565b919050565b600067ffffffffffffffff8211156111d7576111d6611141565b5b6111e082611130565b9050602081019050919050565b82818337600083830152505050565b600061120f61120a846111bc565b6111a1565b90508281526020810184848401111561122b5761122a61112b565b5b6112368482856111ed565b509392505050565b600082601f83011261125357611252611126565b5b81356112638482602086016111fc565b91505092915050565b6000819050919050565b61127f8161126c565b811461128a57600080fd5b50565b60008135905061129c81611276565b92915050565b600067ffffffffffffffff8211156112bd576112bc611141565b5b602082029050602081019050919050565b600080fd5b60006112e66112e1846112a2565b6111a1565b90508083825260208201905060208402830185811115611309576113086112ce565b5b835b8181101561135057803567ffffffffffffffff81111561132e5761132d611126565b5b80860161133b898261123e565b8552602085019450505060208101905061130b565b5050509392505050565b600082601f83011261136f5761136e611126565b5b813561137f8482602086016112d3565b91505092915050565b6000806000606084860312156113a1576113a061111c565b5b600084013567ffffffffffffffff8111156113bf576113be611121565b5b6113cb8682870161123e565b93505060206113dc8682870161128d565b925050604084013567ffffffffffffffff8111156113fd576113fc611121565b5b6114098682870161135a565b9150509250925092565b6000602082840312156114295761142861111c565b5b60006114378482850161128d565b91505092915050565b60008115159050919050565b61145581611440565b82525050565b6000602082019050611470600083018461144c565b92915050565b6000806040838503121561148d5761148c61111c565b5b600083013567ffffffffffffffff8111156114ab576114aa611121565b5b6114b78582860161123e565b92505060206114c88582860161128d565b9150509250929050565b600067ffffffffffffffff82169050919050565b6114ef816114d2565b81146114fa57600080fd5b50565b60008135905061150c816114e6565b92915050565b6000602082840312156115285761152761111c565b5b6000611536848285016114fd565b91505092915050565b6000819050919050565b6115528161153f565b811461155d57600080fd5b50565b60008135905061156f81611549565b92915050565b6000806040838503121561158c5761158b61111c565b5b600061159a8582860161128d565b92505060206115ab85828601611560565b9150509250929050565b6115be8161126c565b82525050565b6115cd8161153f565b82525050565b60006060820190506115e860008301866115b5565b6115f560208301856115c4565b611602604083018461144c565b949350505050565b6000602082840312156116205761161f61111c565b5b600061162e84828501611560565b91505092915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600061166282611637565b9050919050565b61167281611657565b82525050565b600060208201905061168d6000830184611669565b92915050565b600067ffffffffffffffff8211156116ae576116ad611141565b5b602082029050602081019050919050565b60006116d26116cd84611693565b6111a1565b905080838252602082019050602084028301858111156116f5576116f46112ce565b5b835b8181101561171e578061170a888261128d565b8452602084019350506020810190506116f7565b5050509392505050565b600082601f83011261173d5761173c611126565b5b813561174d8482602086016116bf565b91505092915050565b600067ffffffffffffffff82111561177157611770611141565b5b602082029050602081019050919050565b600061179561179084611756565b6111a1565b905080838252602082019050602084028301858111156117b8576117b76112ce565b5b835b818110156117e157806117cd8882611560565b8452602084019350506020810190506117ba565b5050509392505050565b600082601f830112611800576117ff611126565b5b8135611810848260208601611782565b91505092915050565b600080600080608085870312156118335761183261111c565b5b60006118418782880161128d565b94505060206118528782880161128d565b935050604085013567ffffffffffffffff81111561187357611872611121565b5b61187f87828801611728565b925050606085013567ffffffffffffffff8111156118a05761189f611121565b5b6118ac878288016117eb565b91505092959194509250565b6000806000606084860312156118d1576118d061111c565b5b60006118df8682870161128d565b935050602084013567ffffffffffffffff811115611900576118ff611121565b5b61190c8682870161123e565b925050604084013567ffffffffffffffff81111561192d5761192c611121565b5b6119398682870161123e565b9150509250925092565b600081519050919050565b600082825260208201905092915050565b60005b8381101561197d578082015181840152602081019050611962565b60008484015250505050565b600061199482611943565b61199e818561194e565b93506119ae81856020860161195f565b6119b781611130565b840191505092915050565b600060608201905081810360008301526119dc8186611989565b905081810360208301526119f08185611989565b90506119ff604083018461144c565b949350505050565b6000611a1282611637565b9050919050565b611a2281611a07565b82525050565b6000602082019050611a3d6000830184611a19565b92915050565b6000604082019050611a5860008301856115b5565b611a65602083018461144c565b9392505050565b60008060408385031215611a8357611a8261111c565b5b6000611a918582860161128d565b925050602083013567ffffffffffffffff811115611ab257611ab1611121565b5b611abe8582860161123e565b9150509250929050565b611ad181611a07565b8114611adc57600080fd5b50565b600081359050611aee81611ac8565b92915050565b60008060408385031215611b0b57611b0a61111c565b5b6000611b1985828601611adf565b9250506020611b2a858286016114fd565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000611b9d8261153f565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8203611bcf57611bce611b63565b5b600182019050919050565b600081905092915050565b6000611bf082611943565b611bfa8185611bda565b9350611c0a81856020860161195f565b80840191505092915050565b6000611c228284611be5565b915081905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680611c7457607f821691505b602082108103611c8757611c86611c2d565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b600060088302611cef7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82611cb2565b611cf98683611cb2565b95508019841693508086168417925050509392505050565b6000819050919050565b6000611d36611d31611d2c8461153f565b611d11565b61153f565b9050919050565b6000819050919050565b611d5083611d1b565b611d64611d5c82611d3d565b848454611cbf565b825550505050565b600090565b611d79611d6c565b611d84818484611d47565b505050565b5b81811015611da857611d9d600082611d71565b600181019050611d8a565b5050565b601f821115611ded57611dbe81611c8d565b611dc784611ca2565b81016020851015611dd6578190505b611dea611de285611ca2565b830182611d89565b50505b505050565b600082821c905092915050565b6000611e1060001984600802611df2565b1980831691505092915050565b6000611e298383611dff565b9150826002028217905092915050565b611e4282611943565b67ffffffffffffffff811115611e5b57611e5a611141565b5b611e658254611c5c565b611e70828285611dac565b600060209050601f831160018114611ea35760008415611e91578287015190505b611e9b8582611e1d565b865550611f03565b601f198416611eb186611c8d565b60005b82811015611ed957848901518255600182019150602085019450602081019050611eb4565b86831015611ef65784890151611ef2601f891682611dff565b8355505b6001600288020188555050505b505050505050565b600081905092915050565b7f19457468657265756d205369676e6564204d6573736167653a0a333200000000600082015250565b6000611f4c601c83611f0b565b9150611f5782611f16565b601c82019050919050565b6000819050919050565b611f7d611f788261126c565b611f62565b82525050565b6000611f8e82611f3f565b9150611f9a8284611f6c565b60208201915081905092915050565b600060ff82169050919050565b611fbf81611fa9565b82525050565b6000608082019050611fda60008301876115b5565b611fe76020830186611fb6565b611ff460408301856115b5565b61200160608301846115b5565b9594505050505056fea2646970667358221220956ea81f5831f766350597015e0e1e13ab95277ed4eb45a8dce6a43d664f8baf64736f6c6343000811003300000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000003000000000000000000000000e252d01a37b85e2007ed3cc13797aa92496204a40000000000000000000000005f15294a1918633d4dd4ec47098a14d01c58e957000000000000000000000000d45cfd6855c6ec8f635a6f2b46c647e99c59c79d");
}

// 调用合约 phr.sol 的 ResAdd 函数
if (args[0] == 2) {
    call_contract("cfefc010");
}
