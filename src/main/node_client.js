const Web3 = require('web3')
var net = require('net');
var web3 = new Web3(new Web3.providers.IpcProvider('/Users/myuser/Library/Ethereum/geth.ipc', net));
const { randomBytes } = require('crypto')
const Secp256k1 = require('./secp256k1_1')
const keccak256 = require('keccak256')
var querystring = require('querystring');
var http = require('http');
var fs = require('fs');

function hexToBytes(hex) {
    for (var bytes = [], c = 0; c < hex.length; c += 2)
        bytes.push(parseInt(hex.substr(c, 2), 16));
    return bytes;
}

function PostCode(data) {
    var post_data = querystring.stringify(data);
    var post_options = {
        host: '127.0.0.1',
        port: '8781',
        path: '/transaction',
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'Content-Length': Buffer.byteLength(post_data)
        }
    };

    var post_req = http.request(post_options, function (res) {
        res.setEncoding('utf8');
        res.on('data', function (chunk) {
            if (chunk != "ok") {
                console.log('Response: ' + chunk + ", " + data);
            } else {
                console.log('Response: ' + chunk + ", " + data);
            }
        })
    });

    post_req.write(post_data);
    post_req.end();
}

function GetValidHexString(uint256_bytes) {
    var str_res = uint256_bytes.toString(16)
    while (str_res.length < 64) {
        str_res = "0" + str_res;
    }

    return str_res;
}

function param_contract(tx_type, gid, to, amount, gas_limit, gas_price, contract_bytes, input, prepay, prikey) {
    // 私钥
    const privateKeyBuf = Secp256k1.uint256(prikey, 16)
    var self_private_key = Secp256k1.uint256(privateKeyBuf, 16)
    var self_public_key = Secp256k1.generatePublicKeyFromPrivateKeyData(self_private_key)

    // 将内容编码
    var gid = GetValidHexString(Secp256k1.uint256(randomBytes(32)));
    var frompk = '04' + self_public_key.x.toString(16) + self_public_key.y.toString(16);
    const MAX_UINT32 = 0xFFFFFFFF;
    var amount_buf = new Buffer(8);
    var big = ~~(amount / MAX_UINT32)
    var low = (amount % MAX_UINT32) - big
    amount_buf.writeUInt32LE(big, 4)
    amount_buf.writeUInt32LE(low, 0)

    var gas_limit_buf = new Buffer(8);
    var big = ~~(gas_limit / MAX_UINT32)
    var low = (gas_limit % MAX_UINT32) - big
    gas_limit_buf.writeUInt32LE(big, 4)
    gas_limit_buf.writeUInt32LE(low, 0)

    var gas_price_buf = new Buffer(8);
    var big = ~~(gas_price / MAX_UINT32)
    var low = (gas_price % MAX_UINT32) - big
    gas_price_buf.writeUInt32LE(big, 4)
    gas_price_buf.writeUInt32LE(low, 0)

    var step_buf = new Buffer(8);
    var big = ~~(tx_type / MAX_UINT32)
    var low = (tx_type % MAX_UINT32) - big
    step_buf.writeUInt32LE(big, 0)
    step_buf.writeUInt32LE(low, 0)

    var prepay_buf = new Buffer(8);
    var big = ~~(prepay / MAX_UINT32)
    var low = (prepay % MAX_UINT32) - big
    prepay_buf.writeUInt32LE(big, 4)
    prepay_buf.writeUInt32LE(low, 0)

    var message_buf = Buffer.concat([Buffer.from(gid, 'hex'), Buffer.from(frompk, 'hex'), Buffer.from(to, 'hex'),
        amount_buf, gas_limit_buf, gas_price_buf, step_buf, Buffer.from(contract_bytes, 'hex'), Buffer.from(input, 'hex'), prepay_buf]);

    // 签名
    var kechash = keccak256(message_buf)
    var digest = Secp256k1.uint256(kechash, 16)
    const sig = Secp256k1.ecsign(self_private_key, digest)
    const sigR = Secp256k1.uint256(sig.r, 16)
    const sigS = Secp256k1.uint256(sig.s, 16)

    // 发送给链的交易参数
    return {
        'gid': gid,
        'pubkey': '04' + self_public_key.x.toString(16) + self_public_key.y.toString(16),
        'to': to,
        'amount': amount,
        'gas_limit': gas_limit,
        'gas_price': gas_price,
        'type': tx_type,
        'shard_id': 3,
        'hash': kechash,
        'attrs_size': 4,
        "bytes_code": contract_bytes,
        "input": input,
        "pepay": prepay,
        'sign_r': sigR.toString(16),
        'sign_s': sigS.toString(16),
        'sign_v': sig.v,
    }
}

function create_tx(to, amount, gas_limit, gas_price) {
    // 私钥
    const privateKeyBuf = Secp256k1.uint256("fa04ebee157c6c10bd9d250fc2c938780bf68cbe30e9f0d7c048e4d081907971", 16)
    var self_private_key = Secp256k1.uint256(privateKeyBuf, 16)
    var self_public_key = Secp256k1.generatePublicKeyFromPrivateKeyData(self_private_key)

    // 将内容编码
    var gid = GetValidHexString(Secp256k1.uint256(randomBytes(32)));
    var tx_type = 0;
    var frompk = '04' + self_public_key.x.toString(16) + self_public_key.y.toString(16);
    const MAX_UINT32 = 0xFFFFFFFF;
    var amount_buf = new Buffer(8);
    var big = ~~(amount / MAX_UINT32)
    var low = (amount % MAX_UINT32) - big
    amount_buf.writeUInt32LE(big, 4)
    amount_buf.writeUInt32LE(low, 0)

    var gas_limit_buf = new Buffer(8);
    var big = ~~(gas_limit / MAX_UINT32)
    var low = (gas_limit % MAX_UINT32) - big
    gas_limit_buf.writeUInt32LE(big, 4)
    gas_limit_buf.writeUInt32LE(low, 0)

    var gas_price_buf = new Buffer(8);
    var big = ~~(gas_price / MAX_UINT32)
    var low = (gas_price % MAX_UINT32) - big
    gas_price_buf.writeUInt32LE(big, 4)
    gas_price_buf.writeUInt32LE(low, 0)
    var step_buf = new Buffer(8);
    var big = ~~(tx_type / MAX_UINT32)
    var low = (tx_type % MAX_UINT32) - big
    step_buf.writeUInt32LE(big, 0)
    step_buf.writeUInt32LE(low, 0)

    var message_buf = Buffer.concat([Buffer.from(gid, 'hex'), Buffer.from(frompk, 'hex'), Buffer.from(to, 'hex'),
        amount_buf, gas_limit_buf, gas_price_buf, step_buf]);

    // 签名
    var kechash = keccak256(message_buf)
    var digest = Secp256k1.uint256(kechash, 16)
    const sig = Secp256k1.ecsign(self_private_key, digest)
    const sigR = Secp256k1.uint256(sig.r, 16)
    const sigS = Secp256k1.uint256(sig.s, 16)

    // 发送给链的交易参数
    return {
        'gid': gid,
        'pubkey': '04' + self_public_key.x.toString(16) + self_public_key.y.toString(16),
        'to': to,
        'amount': amount,
        'gas_limit': gas_limit,
        'gas_price': gas_price,
        'type': tx_type,
        'shard_id': 3,
        'sign_r': sigR.toString(16),
        'sign_s': sigS.toString(16),
        'sign_v': sig.v,
    }
}

// 创建合约
function new_contract(contract_bytes, prikey) {
    var gid = GetValidHexString(Secp256k1.uint256(randomBytes(32)));
    const privateKeyBuf = Secp256k1.uint256(prikey, 16)
    var self_private_key = Secp256k1.uint256(privateKeyBuf, 16)
    var self_public_key = Secp256k1.generatePublicKeyFromPrivateKeyData(self_private_key)
    var pk_bytes = hexToBytes(self_public_key.x.toString(16) + self_public_key.y.toString(16))
    var address = keccak256(pk_bytes).toString('hex')
    var self_account_id = address.slice(address.length - 40, address.length)
    var kechash = keccak256(self_account_id + gid + contract_bytes).toString('hex')
    var self_contract_address = kechash.slice(kechash.length - 40, kechash.length)
    var data = param_contract(
        6,
        gid,
        self_contract_address,
        10000000,
        10000000,
        1,
        contract_bytes,
        "",
        999999999,
        prikey);
    PostCode(data);

    const opt = { flag: 'w', }
    fs.writeFile('contract_address', self_contract_address, opt, (err) => {
        if (err) {
            console.error(err)
        }
    })
}

// 调用合约, 收回预付费 input = ""
function call_contract(input, prikey) {
    var contract_address = fs.readFileSync('contract_address', 'utf-8');
    var gid = GetValidHexString(Secp256k1.uint256(randomBytes(32)));
    var amount = 0;
    if (input != "") {
        amount = 10000000;
    }

    var data = param_contract(
        8,
        gid,
        contract_address,
        amount,
        10000000,
        1,
        "",
        input,
        0,
        prikey);
    PostCode(data);
}

// 设置预付费 prepayment > 0
function prepay_contract(prikey, prepayment) {
    var contract_address = fs.readFileSync('contract_address', 'utf-8');
    var gid = GetValidHexString(Secp256k1.uint256(randomBytes(32)));
    var data = param_contract(
        7,
        gid,
        contract_address,
        0,
        10000000,
        1,
        "",
        "",
        prepayment,
        prikey);
    PostCode(data);
}

// 普通交易和kv写入
function do_transaction(to_addr, amount, gas_limit, gas_price, key, value) {
    var data = create_tx(to_addr, amount, gas_limit, gas_price);
    PostCode(data);
}

const args = process.argv.slice(2)
var prikey = "fa04ebee157c6c10bd9d250fc2c938780bf68cbe30e9f0d7c048e4d081907971";
if (args.length >= 2) {
    prikey = args[1];
}

// 普通交易，并写入kv数据
if (args[0] == 0) {
    do_transaction(args[1], 100000, 10000, 1, "key", "value");
}

// 创建合约 phr.sol
if (args[0] == 1) {
    new_contract(
        "6080604052604051620024bb380380620024bb833981810160405281019062000029919062000326565b8060009080519060200190620000419291906200008a565b5033600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505062000377565b82805482825590600052602060002090810192821562000106579160200282015b82811115620001055782518260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555091602001919060010190620000ab565b5b50905062000115919062000119565b5090565b5b80821115620001345760008160009055506001016200011a565b5090565b6000604051905090565b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6200019c8262000151565b810181811067ffffffffffffffff82111715620001be57620001bd62000162565b5b80604052505050565b6000620001d362000138565b9050620001e1828262000191565b919050565b600067ffffffffffffffff82111562000204576200020362000162565b5b602082029050602081019050919050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600062000247826200021a565b9050919050565b62000259816200023a565b81146200026557600080fd5b50565b60008151905062000279816200024e565b92915050565b6000620002966200029084620001e6565b620001c7565b90508083825260208201905060208402830185811115620002bc57620002bb62000215565b5b835b81811015620002e95780620002d4888262000268565b845260208401935050602081019050620002be565b5050509392505050565b600082601f8301126200030b576200030a6200014c565b5b81516200031d8482602086016200027f565b91505092915050565b6000602082840312156200033f576200033e62000142565b5b600082015167ffffffffffffffff81111562000360576200035f62000147565b5b6200036e84828501620002f3565b91505092915050565b61213480620003876000396000f3fe6080604052600436106101145760003560e01c80636b83e059116100a0578063b89e70b511610064578063b89e70b5146103f1578063cfefc0101461042e578063e645df4314610438578063e9c7feda14610454578063fdba8f111461049157610114565b80636b83e059146102cf5780637e2803781461030c5780638da5cb5b1461034b578063a51f8aac14610376578063ae0ad9d9146103b457610114565b8063348a2b91116100e7578063348a2b91146101e55780634819544b146102015780635f13d6ee146102405780636189d2df1461027d578063691b3463146102a657610114565b806308ad872a146101195780630ef403f81461014257806329c1cb4b1461017f5780632a1343a7146101bc575b600080fd5b34801561012557600080fd5b50610140600480360381019061013b9190611410565b6104ba565b005b34801561014e57600080fd5b506101696004803603810190610164919061149b565b610622565b60405161017691906114e3565b60405180910390f35b34801561018b57600080fd5b506101a660048036038101906101a191906114fe565b61064f565b6040516101b391906114e3565b60405180910390f35b3480156101c857600080fd5b506101e360048036038101906101de91906115ee565b610696565b005b6101ff60048036038101906101fa919061166e565b6106ea565b005b34801561020d57600080fd5b506102286004803603810190610223919061169b565b61073e565b604051610237939291906116f9565b60405180910390f35b34801561024c57600080fd5b5061026760048036038101906102629190611730565b610792565b604051610274919061176c565b60405180910390f35b34801561028957600080fd5b506102a4600480360381019061029f919061190d565b6107d1565b005b3480156102b257600080fd5b506102cd60048036038101906102c891906119ac565b6109af565b005b3480156102db57600080fd5b506102f660048036038101906102f191906114fe565b610abc565b60405161030391906114e3565b60405180910390f35b34801561031857600080fd5b50610333600480360381019061032e919061149b565b610b01565b60405161034293929190611ab6565b60405180910390f35b34801561035757600080fd5b50610360610c48565b60405161036d9190611b1c565b60405180910390f35b34801561038257600080fd5b5061039d6004803603810190610398919061149b565b610c6e565b6040516103ab929190611b37565b60405180910390f35b3480156103c057600080fd5b506103db60048036038101906103d69190611b60565b610c9f565b6040516103e891906114e3565b60405180910390f35b3480156103fd57600080fd5b506104186004803603810190610413919061149b565b610ce4565b60405161042591906114e3565b60405180910390f35b610436610d6b565b005b610452600480360381019061044d9190611be8565b610da6565b005b34801561046057600080fd5b5061047b600480360381019061047691906114fe565b610dfb565b60405161048891906114e3565b60405180910390f35b34801561049d57600080fd5b506104b860048036038101906104b39190611410565b610f14565b005b8051600080549050146104cc57600080fd5b60005b815181101561058c57600081815481106104ec576104eb611c28565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16610559610539856110c9565b84848151811061054c5761054b611c28565b5b60200260200101516110f9565b73ffffffffffffffffffffffffffffffffffffffff161461057957600080fd5b808061058490611c86565b9150506104cf565b50600160038460405161059f9190611d0a565b9081526020016040518091039020600084815260200190815260200160002060006101000a81548160ff021916908315150217905550600160046000848152602001908152602001600020846040516105f89190611d0a565b908152602001604051809103902060006101000a81548160ff021916908315150217905550505050565b60006002600083815260200190815260200160002060020160009054906101000a900460ff169050919050565b60006003836040516106619190611d0a565b9081526020016040518091039020600083815260200190815260200160002060009054906101000a900460ff16905092915050565b808273ffffffffffffffffffffffffffffffffffffffff16427fa6b5ddd331f9dc412a8c258207b1c66f53c1740c72628d9913aafcb6b28d8f73336040516106de919061176c565b60405180910390a45050565b3373ffffffffffffffffffffffffffffffffffffffff166108fc8267ffffffffffffffff169081150290604051600060405180830381858888f1935050505015801561073a573d6000803e3d6000fd5b5050565b6005602052816000526040600020818154811061075a57600080fd5b9060005260206000209060030201600091509150508060000154908060010154908060020160009054906101000a900460ff16905083565b600081815481106107a257600080fd5b906000526020600020016000915054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b3373ffffffffffffffffffffffffffffffffffffffff16600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161461082b57600080fd5b6006600085815260200190815260200160002060010160009054906101000a900460ff161561085957600080fd5b805182511461086757600080fd5b604051806040016040528084815260200160011515815250600660008681526020019081526020016000206000820151816000015560208201518160010160006101000a81548160ff02191690831515021790555090505060008251905060005b818110156109a75760056000868152602001908152602001600020604051806060016040528086848151811061090157610900611c28565b5b6020026020010151815260200185848151811061092157610920611c28565b5b60200260200101518152602001600115158152509080600181540180825580915050600190039060005260206000209060030201600090919091909150600082015181600001556020820151816001015560408201518160020160006101000a81548160ff0219169083151502179055505050808061099f90611c86565b9150506108c8565b505050505050565b3373ffffffffffffffffffffffffffffffffffffffff16600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614610a0957600080fd5b6002600084815260200190815260200160002060020160009054906101000a900460ff1615610a3757600080fd5b604051806060016040528083815260200182815260200160011515815250600260008581526020019081526020016000206000820151816000019081610a7d9190611f2d565b506020820151816001019081610a939190611f2d565b5060408201518160020160006101000a81548160ff021916908315150217905550905050505050565b6003828051602081018201805184825260208301602085012081835280955050505050506020528060005260406000206000915091509054906101000a900460ff1681565b6002602052806000526040600020600091509050806000018054610b2490611d50565b80601f0160208091040260200160405190810160405280929190818152602001828054610b5090611d50565b8015610b9d5780601f10610b7257610100808354040283529160200191610b9d565b820191906000526020600020905b815481529060010190602001808311610b8057829003601f168201915b505050505090806001018054610bb290611d50565b80601f0160208091040260200160405190810160405280929190818152602001828054610bde90611d50565b8015610c2b5780601f10610c0057610100808354040283529160200191610c2b565b820191906000526020600020905b815481529060010190602001808311610c0e57829003601f168201915b5050505050908060020160009054906101000a900460ff16905083565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60066020528060005260406000206000915090508060000154908060010160009054906101000a900460ff16905082565b6004602052816000526040600020818051602081018201805184825260208301602085012081835280955050505050506000915091509054906101000a900460ff1681565b60003373ffffffffffffffffffffffffffffffffffffffff16600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614610d4057600080fd5b6006600083815260200190815260200160002060010160009054906101000a900460ff169050919050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b8173ffffffffffffffffffffffffffffffffffffffff166108fc8267ffffffffffffffff169081150290604051600060405180830381858888f19350505050158015610df6573d6000803e3d6000fd5b505050565b6000806005600084815260200190815260200160002080549050905060008111610e2457600080fd5b60005b81811015610f075760046000600560008781526020019081526020016000208381548110610e5857610e57611c28565b5b906000526020600020906003020160000154815260200190815260200160002085604051610e869190611d0a565b908152602001604051809103902060009054906101000a900460ff168015610ee4575042600560008681526020019081526020016000208281548110610ecf57610ece611c28565b5b90600052602060002090600302016001015410155b15610ef457600192505050610f0e565b8080610eff90611c86565b915050610e27565b5060009150505b92915050565b805160008054905014610f2657600080fd5b60001515600384604051610f3a9190611d0a565b9081526020016040518091039020600084815260200190815260200160002060009054906101000a900460ff16151514610f7357600080fd5b60005b81518110156110335760008181548110610f9357610f92611c28565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16611000610fe0856110c9565b848481518110610ff357610ff2611c28565b5b60200260200101516110f9565b73ffffffffffffffffffffffffffffffffffffffff161461102057600080fd5b808061102b90611c86565b915050610f76565b5060016003846040516110469190611d0a565b9081526020016040518091039020600084815260200190815260200160002060006101000a81548160ff0219169083151502179055506001600460008481526020019081526020016000208460405161109f9190611d0a565b908152602001604051809103902060006101000a81548160ff021916908315150217905550505050565b6000816040516020016110dc9190612077565b604051602081830303815290604052805190602001209050919050565b60008060008061110885611168565b9250925092506001868484846040516000815260200160405260405161113194939291906120b9565b6020604051602081039080840390855afa158015611153573d6000803e3d6000fd5b50505060206040510351935050505092915050565b6000806000604184511461117b57600080fd5b6020840151915060408401519050606084015160001a92509193909250565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b611201826111b8565b810181811067ffffffffffffffff821117156112205761121f6111c9565b5b80604052505050565b600061123361119a565b905061123f82826111f8565b919050565b600067ffffffffffffffff82111561125f5761125e6111c9565b5b611268826111b8565b9050602081019050919050565b82818337600083830152505050565b600061129761129284611244565b611229565b9050828152602081018484840111156112b3576112b26111b3565b5b6112be848285611275565b509392505050565b600082601f8301126112db576112da6111ae565b5b81356112eb848260208601611284565b91505092915050565b6000819050919050565b611307816112f4565b811461131257600080fd5b50565b600081359050611324816112fe565b92915050565b600067ffffffffffffffff821115611345576113446111c9565b5b602082029050602081019050919050565b600080fd5b600061136e6113698461132a565b611229565b9050808382526020820190506020840283018581111561139157611390611356565b5b835b818110156113d857803567ffffffffffffffff8111156113b6576113b56111ae565b5b8086016113c389826112c6565b85526020850194505050602081019050611393565b5050509392505050565b600082601f8301126113f7576113f66111ae565b5b813561140784826020860161135b565b91505092915050565b600080600060608486031215611429576114286111a4565b5b600084013567ffffffffffffffff811115611447576114466111a9565b5b611453868287016112c6565b935050602061146486828701611315565b925050604084013567ffffffffffffffff811115611485576114846111a9565b5b611491868287016113e2565b9150509250925092565b6000602082840312156114b1576114b06111a4565b5b60006114bf84828501611315565b91505092915050565b60008115159050919050565b6114dd816114c8565b82525050565b60006020820190506114f860008301846114d4565b92915050565b60008060408385031215611515576115146111a4565b5b600083013567ffffffffffffffff811115611533576115326111a9565b5b61153f858286016112c6565b925050602061155085828601611315565b9150509250929050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006115858261155a565b9050919050565b6115958161157a565b81146115a057600080fd5b50565b6000813590506115b28161158c565b92915050565b6000819050919050565b6115cb816115b8565b81146115d657600080fd5b50565b6000813590506115e8816115c2565b92915050565b60008060408385031215611605576116046111a4565b5b6000611613858286016115a3565b9250506020611624858286016115d9565b9150509250929050565b600067ffffffffffffffff82169050919050565b61164b8161162e565b811461165657600080fd5b50565b60008135905061166881611642565b92915050565b600060208284031215611684576116836111a4565b5b600061169284828501611659565b91505092915050565b600080604083850312156116b2576116b16111a4565b5b60006116c085828601611315565b92505060206116d1858286016115d9565b9150509250929050565b6116e4816112f4565b82525050565b6116f3816115b8565b82525050565b600060608201905061170e60008301866116db565b61171b60208301856116ea565b61172860408301846114d4565b949350505050565b600060208284031215611746576117456111a4565b5b6000611754848285016115d9565b91505092915050565b6117668161157a565b82525050565b6000602082019050611781600083018461175d565b92915050565b600067ffffffffffffffff8211156117a2576117a16111c9565b5b602082029050602081019050919050565b60006117c66117c184611787565b611229565b905080838252602082019050602084028301858111156117e9576117e8611356565b5b835b8181101561181257806117fe8882611315565b8452602084019350506020810190506117eb565b5050509392505050565b600082601f830112611831576118306111ae565b5b81356118418482602086016117b3565b91505092915050565b600067ffffffffffffffff821115611865576118646111c9565b5b602082029050602081019050919050565b60006118896118848461184a565b611229565b905080838252602082019050602084028301858111156118ac576118ab611356565b5b835b818110156118d557806118c188826115d9565b8452602084019350506020810190506118ae565b5050509392505050565b600082601f8301126118f4576118f36111ae565b5b8135611904848260208601611876565b91505092915050565b60008060008060808587031215611927576119266111a4565b5b600061193587828801611315565b945050602061194687828801611315565b935050604085013567ffffffffffffffff811115611967576119666111a9565b5b6119738782880161181c565b925050606085013567ffffffffffffffff811115611994576119936111a9565b5b6119a0878288016118df565b91505092959194509250565b6000806000606084860312156119c5576119c46111a4565b5b60006119d386828701611315565b935050602084013567ffffffffffffffff8111156119f4576119f36111a9565b5b611a00868287016112c6565b925050604084013567ffffffffffffffff811115611a2157611a206111a9565b5b611a2d868287016112c6565b9150509250925092565b600081519050919050565b600082825260208201905092915050565b60005b83811015611a71578082015181840152602081019050611a56565b60008484015250505050565b6000611a8882611a37565b611a928185611a42565b9350611aa2818560208601611a53565b611aab816111b8565b840191505092915050565b60006060820190508181036000830152611ad08186611a7d565b90508181036020830152611ae48185611a7d565b9050611af360408301846114d4565b949350505050565b6000611b068261155a565b9050919050565b611b1681611afb565b82525050565b6000602082019050611b316000830184611b0d565b92915050565b6000604082019050611b4c60008301856116db565b611b5960208301846114d4565b9392505050565b60008060408385031215611b7757611b766111a4565b5b6000611b8585828601611315565b925050602083013567ffffffffffffffff811115611ba657611ba56111a9565b5b611bb2858286016112c6565b9150509250929050565b611bc581611afb565b8114611bd057600080fd5b50565b600081359050611be281611bbc565b92915050565b60008060408385031215611bff57611bfe6111a4565b5b6000611c0d85828601611bd3565b9250506020611c1e85828601611659565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000611c91826115b8565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8203611cc357611cc2611c57565b5b600182019050919050565b600081905092915050565b6000611ce482611a37565b611cee8185611cce565b9350611cfe818560208601611a53565b80840191505092915050565b6000611d168284611cd9565b915081905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680611d6857607f821691505b602082108103611d7b57611d7a611d21565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b600060088302611de37fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82611da6565b611ded8683611da6565b95508019841693508086168417925050509392505050565b6000819050919050565b6000611e2a611e25611e20846115b8565b611e05565b6115b8565b9050919050565b6000819050919050565b611e4483611e0f565b611e58611e5082611e31565b848454611db3565b825550505050565b600090565b611e6d611e60565b611e78818484611e3b565b505050565b5b81811015611e9c57611e91600082611e65565b600181019050611e7e565b5050565b601f821115611ee157611eb281611d81565b611ebb84611d96565b81016020851015611eca578190505b611ede611ed685611d96565b830182611e7d565b50505b505050565b600082821c905092915050565b6000611f0460001984600802611ee6565b1980831691505092915050565b6000611f1d8383611ef3565b9150826002028217905092915050565b611f3682611a37565b67ffffffffffffffff811115611f4f57611f4e6111c9565b5b611f598254611d50565b611f64828285611ea0565b600060209050601f831160018114611f975760008415611f85578287015190505b611f8f8582611f11565b865550611ff7565b601f198416611fa586611d81565b60005b82811015611fcd57848901518255600182019150602085019450602081019050611fa8565b86831015611fea5784890151611fe6601f891682611ef3565b8355505b6001600288020188555050505b505050505050565b600081905092915050565b7f19457468657265756d205369676e6564204d6573736167653a0a333200000000600082015250565b6000612040601c83611fff565b915061204b8261200a565b601c82019050919050565b6000819050919050565b61207161206c826112f4565b612056565b82525050565b600061208282612033565b915061208e8284612060565b60208201915081905092915050565b600060ff82169050919050565b6120b38161209d565b82525050565b60006080820190506120ce60008301876116db565b6120db60208301866120aa565b6120e860408301856116db565b6120f560608301846116db565b9594505050505056fea2646970667358221220c9deea311a71fcaffae699570b7b4665b28f00d257f9c9f0a3dcd6414ebebc6264736f6c6343000811003300000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000003000000000000000000000000e252d01a37b85e2007ed3cc13797aa92496204a40000000000000000000000005f15294a1918633d4dd4ec47098a14d01c58e957000000000000000000000000d45cfd6855c6ec8f635a6f2b46c647e99c59c79d",
        prikey);
}

// 调用合约 phr.sol 的 ResAdd 函数
if (args[0] == 2) {
    call_contract("cfefc010", prikey);
}

if (args[0] == 3) {
    call_contract("348a2b9100000000000000000000000000000000000000000000000000000000000003e8", prikey);
}

if (args[0] == 4) {
    call_contract("e645df43000000000000000000000000e252d01a37b85e2007ed3cc13797aa92496204a400000000000000000000000000000000000000000000000000000000000003e8", prikey);
}

if (args[0] == 5) {
    prepay_contract(prikey, 1000);
}

if (args[0] == 6) {
    call_contract("", prikey);
}